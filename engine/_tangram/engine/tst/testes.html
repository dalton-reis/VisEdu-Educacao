<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <script src="../lib/prototype-1.6.0.2.js"></script>

  <script src="../src/physic/box2d/common/b2Settings.js"></script>
  <script src="../src/physic/box2d/common/math/b2Vec2.js"></script>
  <script src="../src/physic/box2d/common/math/b2Mat22.js"></script>
  <script src="../src/physic/box2d/common/math/b2Math.js"></script>
  <script src="../src/physic/box2d/collision/b2AABB.js"></script>
  <script src="../src/physic/box2d/collision/b2Bound.js"></script>
  <script src="../src/physic/box2d/collision/b2BoundValues.js"></script>
  <script src="../src/physic/box2d/collision/b2Pair.js"></script>
  <script src="../src/physic/box2d/collision/b2PairCallback.js"></script>
  <script src="../src/physic/box2d/collision/b2BufferedPair.js"></script>
  <script src="../src/physic/box2d/collision/b2PairManager.js"></script>
  <script src="../src/physic/box2d/collision/b2BroadPhase.js"></script>
  <script src="../src/physic/box2d/collision/b2Collision.js"></script>
  <script src="../src/physic/box2d/collision/Features.js"></script>
  <script src="../src/physic/box2d/collision/b2ContactID.js"></script>
  <script src="../src/physic/box2d/collision/b2ContactPoint.js"></script>
  <script src="../src/physic/box2d/collision/b2Distance.js"></script>
  <script src="../src/physic/box2d/collision/b2Manifold.js"></script>
  <script src="../src/physic/box2d/collision/b2OBB.js"></script>
  <script src="../src/physic/box2d/collision/b2Proxy.js"></script>
  <script src="../src/physic/box2d/collision/ClipVertex.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2Shape.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2ShapeDef.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2BoxDef.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2CircleDef.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2CircleShape.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2MassData.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2PolyDef.js"></script>
  <script src="../src/physic/box2d/collision/shapes/b2PolyShape.js"></script>
  <script src="../src/physic/box2d/dynamics/b2Body.js"></script>
  <script src="../src/physic/box2d/dynamics/b2BodyDef.js"></script>
  <script src="../src/physic/box2d/dynamics/b2CollisionFilter.js"></script>
  <script src="../src/physic/box2d/dynamics/b2Island.js"></script>
  <script src="../src/physic/box2d/dynamics/b2TimeStep.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2ContactNode.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2Contact.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2ContactConstraint.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2ContactConstraintPoint.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2ContactRegister.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2ContactSolver.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2CircleContact.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2Conservative.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2NullContact.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2PolyAndCircleContact.js"></script>
  <script src="../src/physic/box2d/dynamics/contacts/b2PolyContact.js"></script>
  <script src="../src/physic/box2d/dynamics/b2ContactManager.js"></script>
  <script src="../src/physic/box2d/dynamics/b2World.js"></script>
  <script src="../src/physic/box2d/dynamics/b2WorldListener.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2JointNode.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2Joint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2JointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2DistanceJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2DistanceJointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2Jacobian.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2GearJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2GearJointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2MouseJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2MouseJointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2PrismaticJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2PrismaticJointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2PulleyJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2PulleyJointDef.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2RevoluteJoint.js"></script>
  <script src="../src/physic/box2d/dynamics/joints/b2RevoluteJointDef.js"></script>

  <script src="../src/utils/ArrayUtils.js"></script>
  <script src="../src/utils/ComponentUtils.js"></script>
  <script src="../src/utils/JSUtils.js"></script>
  <script src="../src/utils/StringUtils.js"></script>
  <script src="../src/collide/CollideInfo.js"></script>
  <script src="../src/component/Component.js"></script>
  <script src="../src/component/BoxRenderComponent.js"></script>
  <script src="../src/component/CircleRenderComponent.js"></script>
  <script src="../src/component/ImageRenderComponent.js"></script>
  <script src="../src/component/PolygonRenderComponent.js"></script>
  <script src="../src/component/RigidBodyComponent.js"></script>
  <script src="../src/component/RotateComponent.js"></script>
  <script src="../src/component/ScaleComponent.js"></script>
  <script src="../src/component/TranslateComponent.js"></script>
  <script src="../src/component/MoveCameraComponent.js"></script>
  <script src="../src/component/AnimationRenderComponent.js"></script>
  <script src="../src/game/Asset.js"></script>
  <script src="../src/game/AssetStore.js"></script>
  <script src="../src/game/Camera.js"></script>
  <script src="../src/game/Game.js"></script>
  <script src="../src/game/Layer.js"></script>
  <script src="../src/game/Scene.js"></script>
  <script src="../src/gameobject/GameObject.js"></script>
  <script src="../src/gameobject/BoxObject.js"></script>
  <script src="../src/gameobject/CircleObject.js"></script>
  <script src="../src/gameobject/PolygonObject.js"></script>
  <script src="../src/geometric/Point2D.js"></script>
  <script src="../src/system/KeySystem.js"></script>
  <script src="../src/system/LogicSystem.js"></script>
  <script src="../src/system/MouseSystem.js"></script>
  <script src="../src/system/RenderSystem.js"></script>

  <script type="text/javascript">
  function ChangeColorComponent(){}
  ChangeColorComponent.prototype = new Component();
  ChangeColorComponent.prototype.onCollide = function(other){
    if(other instanceof PolygonObject){
      ComponentUtils.getComponent(other, "POLYGON_RENDER_COMPONENT").fillStyle="green";
    }
    if(other instanceof BoxObject){
      if(ComponentUtils.getComponent(other, "BOX_RENDER_COMPONENT")){
        ComponentUtils.getComponent(other, "BOX_RENDER_COMPONENT").fillStyle="green";
      }
    }
  }
  ChangeColorComponent.prototype.getSystems = function(){
    var systems = new Array();
    systems = ArrayUtils.addElement(systems, LogicSystem.getTag());
    return systems;
  }
  ChangeColorComponent.prototype.getTag = function(){
    return "CHANGE_COLOR_COMPONENT";
  }

  function buildGame(){
    AssetStore.addAsset(new Asset().initialize("SPRITE_TESTE", "./sprite.png", "IMAGE"));
    AssetStore.addAsset(new Asset().initialize("BEEP_AUDIO", "./beep-02.wav", "AUDIO"));
    AssetStore.addAsset(new Asset().initialize("MARIO_IMAGE", "./mario.png", "IMAGE"));

    var box1 = new BoxObject().initialize(500, 500, 2000, 50, "red", "black");
    var box2 = new BoxObject().initialize(700, 150, 150, 150, "blue", "black");
    var ball = new CircleObject().initialize(250, 100, 30, "green", "black");
    var poly = new PolygonObject().initialize(200, 200, [new Point2D().initialize(-100, 0),
                                                         new Point2D().initialize(100, 0),
                                                         new Point2D().initialize(0, 100)], 
                                              "orange", "black");
    var mario = new BoxObject().initialize(500, 0, 64, 64, "red", "black");

    var layer = new Layer().initialize();
    var scene = new Scene().initialize(-10000, -10000, 10000, 10000);

    ComponentUtils.getComponent(box2, "SCALE_COMPONENT").setScale(1.5, 1.5);
    ComponentUtils.getComponent(ball, "SCALE_COMPONENT").setScale(1.0, 1.0);
    ComponentUtils.getComponent(poly, "SCALE_COMPONENT").setScale(1.5, 1.5);

    ComponentUtils.getComponent(box2, "ROTATE_COMPONENT").setRotate(45);
    ComponentUtils.getComponent(ball, "ROTATE_COMPONENT").setRotate(0);
    ComponentUtils.getComponent(poly, "ROTATE_COMPONENT").setRotate(45);

    ComponentUtils.getComponent(box2, "TRANSLATE_COMPONENT").setTranslate(0, 100);
    ComponentUtils.getComponent(ball, "TRANSLATE_COMPONENT").setTranslate(0, 0);
    ComponentUtils.getComponent(poly, "TRANSLATE_COMPONENT").setTranslate(0, 50);

    ComponentUtils.addComponent(box2,  new RigidBodyComponent().initialize(0,1,false,true,0.2));
    ComponentUtils.addComponent(ball,  new RigidBodyComponent().initialize(0,1,false,true,0.2));
    ComponentUtils.addComponent(poly,  new RigidBodyComponent().initialize(0,1,false,true,0.2));
    ComponentUtils.addComponent(box1,  new RigidBodyComponent().initialize(0,0,false,true,0.2));
    ComponentUtils.addComponent(mario, new RigidBodyComponent().initialize(0,1,false,true,0.2));
    ComponentUtils.addComponent(ball,  new ChangeColorComponent().initialize());
    ComponentUtils.addComponent(mario, new AnimationRenderComponent().initialize(
      AssetStore.getAsset("SPRITE_TESTE").getAssetInstance(), 13, 21));
    ComponentUtils.addComponent(Game,  
                                new MoveCameraComponent().initialize(65, 68, 87, 83, 33, 34, 72, 75, 20, 0.1, 5));

    layer.addGameObject(box1);
    layer.addGameObject(box2);
    layer.addGameObject(ball);
    layer.addGameObject(poly);
    layer.addGameObject(mario);
    scene.addLayer(layer);

    Game.init(document.getElementById("gameCanvas"), scene);

    Game.camera.centerPoint.x = 500;
    Game.camera.centerPoint.y = 300;

    Game.camera.scale.scalePoint.x = 1;
    Game.camera.scale.scalePoint.y = 1;

    ComponentUtils.removeComponent(mario, ComponentUtils.getComponent(mario, "BOX_RENDER_COMPONENT"));

    ComponentUtils.getComponent(mario, "ANIMATION_RENDER_COMPONENT").play("HORIZONTAL", 
                                                                           20, 
                                                                           0, 
                                                                           5, 
                                                                           -1, 
                                                                           150);
  }
  </script>

</head>
<body onload="buildGame();">
  <canvas style="border: 1px solid black;" id="gameCanvas" width="1000" height="500">
</body>
</html>